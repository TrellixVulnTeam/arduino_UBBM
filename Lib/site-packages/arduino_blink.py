from simple_salesforce import Salesforce
import requests
import serial
import http.client
import json
import os
import glob
import time
sf = Salesforce(username='rayhane.hamoumi@hotmail.com.devv', password='Rayhane1991', security_token='DBJLpY7AIgcp1F62gPLBMueY')
print('Okey SF:', sf);
params = {
    "grant_type": "password",
    "client_id": "3MVG9lsAlIP.W_V9qH7Qv_1pZRQ87bx6wDM3mtz5OEaKyvVXaYdC.VCz1h9m3xqfM3RvYtT4WXt5TbsEaq8mN", # Consumer Key
    "client_secret": "D109E2FD937B0A1F21BADA5BE2BEC577C00C016B1CDB026EAF2A8E7F6A3996C9", # Consumer Secret
    "username": "rayhane.hamoumi@hotmail.com.devv", # The email you use to login
    "password": "Rayhane1991DBJLpY7AIgcp1F62gPLBMueY" # Concat your password and your security token
}
r = requests.post("https://login.salesforce.com/services/oauth2/token", params=params)
access_token = r.json().get("access_token")
instance_url = r.json().get("instance_url")
print("Access Token:", access_token)
print("Instance URL", instance_url)

conn = http.client.HTTPSConnection("empathetic-raccoon-fp7a5b-dev-ed.lightning.force.com/") 

port ='COM7'
baud = 9600

ser = serial.Serial(port, baud, timeout=1);
    # open the serial port

if ser.isOpen():
    print(ser.name + ' is openâ€¦')
        
    while True:
        if ser.inWaiting() >0: 
            print('Receiving From Arduino.....')
            outputInBytes = ser.readline()
            outputInString = bytes.decode(outputInBytes)       
            print('outputInString  ='+ outputInString)

            SensorNameARD ,SensorValueARD =  outputInString.split(':')

            print('Connecting to Salesforce.....')


        
            payload = "{\"SensorName\" : \""+SensorNameARD+"\",\"temperature__c\": "+SensorValueARD+"}"
            

            print('Payload Sent to Salesforce ... ' +payload)
            data = [{"Id__c": "1", 'temperature__c': SensorValueARD}]
            #sf.Contact.create({'LastName':'derde','Email':'ray@example.com'})
            sf.bulk.IoT_Automatic_Maintenance__e.insert(data)
            time.sleep(5)
            print("Platform Event Sent")
            print(SensorValueARD)



            
