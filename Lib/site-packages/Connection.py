#!/usr/bin/python
import records 
import cgi
import requests
import json
from simple_salesforce import Salesforce
 
#login here:
#https://login.salesforce.com/services/oauth2/authorize?response_type=code&client_id=3MVG9lsAlIP.W_V9qH7Qv_1pZRQ87bx6wDM3mtz5OEaKyvVXaYdC.VCz1h9m3xqfM3RvYtT4WXt5TbsEaq8mN&redirect_uri=http://localhost/cgi-bin/python/oauth.py
 
consumer_key = '3MVG9lsAlIP.W_V9qH7Qv_1pZRQ87bx6wDM3mtz5OEaKyvVXaYdC.VCz1h9m3xqfM3RvYtT4WXt5TbsEaq8mN'
consumer_secret = 'D109E2FD937B0A1F21BADA5BE2BEC577C00C016B1CDB026EAF2A8E7F6A3996C9'
request_token_url = 'https://login.salesforce.com/services/oauth2/token'
access_token_url = 'https://login.salesforce.com/services/oauth2/token'
redirect_uri = 'http://localhost/cgi-bin/python/oauth.py'
authorize_url = 'https://login.salesforce.com/services/oauth2/authorize' #?response_type=token&client_id='+consumer_key+'&redirect_uri='+redirect_uri
 
query = cgi.FieldStorage()
req = None
 
 
if 'login' in query:
    print ("Location: https://login.salesforce.com/services/oauth2/authorize?response_type=code&client_id="+consumer_key+"&redirect_uri="+redirect_uri)
 
if 'code' in query:
    code = query.getvalue('code')
     
    data = {
                'grant_type': 'authorization_code',
                'redirect_uri': redirect_uri,
                'code': code,
                'client_id' : consumer_key,
                'client_secret' : consumer_secret
            }
    headers = {
                'content-type': 'application/x-www-form-urlencoded'
            }
    req = requests.post(access_token_url,data=data,headers=headers)
    response = req.json()
    sf = Salesforce(instance_url=response['instance_url'], session_id=response['access_token'])
    records = sf.query("SELECT Id, Name, Email FROM Contact")
    records = records['records']
 
#print web page
print ("Content-type: text/html")
 
print ("<html><body>")
print ("<h1>SELECT Id, Name, Email FROM Contact</h1>")
 
print ("<table>")
print ("<tr><td><b>Name</b></td><td><b>Email</b></td></tr>")
for record in records:
        print ("<tr><td>"+record['Name']+"</td><td>"+record['Email']+"</td></tr>")
 
print ("</table>")
 
print ("</body></html>")
