#botanical attempt with Salesforce IoT Cloud
#Rafa Hernandez
import time
from simple_salesforce import Salesforce
from simple_salesforce import SalesforceLogin
from simple_salesforce import SFType
import RPi.GPIO as GPIO
from time import sleep
GPIO.setmode(GPIO.BCM)


pin = 10

#connect to Salesforce
#sf = Salesforce(username=user, password=pwd, security_token=token)
print('will try to connecto to salesforce')
session_id, instance = SalesforceLogin(
    username=rayhane.hamoumi@hotmail.com.devv,
    password=Rayhane1991,
    security_token=DBJLpY7AIgcp1F62gPLBMueY)
print(session_id)
print(instance)
#We create a variable to our plataform Event, note the __e
sensorTemp = SFType('iot-automatic-maintenance',session_id,instance)

# Main program loop.
oldValue = 0
while True:
    #We try to get the humidity and Temperature
    humidity, temperature = Adafruit_DHT.read_retry(11,4)
    print(temperature)
    #I dont really see a point to send the same value over and over....
    if temperature != oldValue :
        oldValue = temperature
        data = sensorTemp.create({'sensorId__c':'109504K94Temp','humedity__c':humidity,'temperature__c':temperature})
    print(data)
    print('Temp={0:0.1f}*C  Humidity={1:0.1f}%'.format(temperature, humidity))
    # Pause for half a second.
    time.sleep(2)
GPIO.cleanup()
